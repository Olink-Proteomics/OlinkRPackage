---
title: "Bridging Olink^®^ Explore 3072 to Olink^®^ Explore HT"
output: 
  html_vignette:
    toc: true
    toc_depth: 3
    includes:
      in_header: ../man/figures/logo.html
vignette: >
  %\VignetteIndexEntry{Bridging Olink^®^ Explore 3072 to Olink^®^ Explore HT}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
date: 'Compiled: `r format(Sys.Date(), "%B %d, %Y")`'
editor_options: 
  markdown: 
    wrap: 72
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  tidy = FALSE,
  tidy.opts = list(width.cutoff = 95),
  fig.width = 6,
  fig.height = 3,
  message = FALSE,
  warning = FALSE,
  time_it = TRUE,
  fig.align = "center"
)
```

```{r, echo=FALSE}
library(OlinkAnalyze)
library(dplyr)
library(stringr)
library(ggplot2)
library(kableExtra)
```

## Introduction

Individual Olink® NPX datasets are normalized using either plate control
normalization or intensity normalization methods. In the case when a study is 
separated into multiple batches, an additional normalization step is needed to 
allow the data to be comparable, since NPX is a relative measurement. The 
following tutorial is designed to give you an overview of the Olink® bridging 
procedure for combining datasets from Explore 3072 and Explore HT products.

### Within- and between-product bridging

The joint analysis of two or more Olink® NPX datasets run on the same Olink® 
product often requires an additional batch correction step to
remove technical variation, which is referred to as overlapping sample 
reference normalization, bridge normalization, or just simply bridging. For more
information on within-product bridging, see the [Introduction to Bridging 
tutorial](https://cran.r-project.org/web/packages/OlinkAnalyze/vignettes/bridging_introduction.html).


Explore 3072 and Explore HT are both Olink® platforms that use PEA technology
combined with next generation sequencing to calculate NPX for thousands of 
proteins. Since many of the assays profiled in Explore 3072 are also found on 
Explore HT, bridging data across products enables increased power in studies 
consisting of both 3072 and HT datasets, rather than limiting these studies to 
meta-analysis. However, these products differ in the number of assays measured 
and in the **antibodies and reagents used**, which means that normalization 
cannot be performed in the same way that within-product bridging is performed.

In the case where a study consists of separate batches run in both the Olink® 
Explore 3072 and the Explore HT platforms, an additional batch correction
step is required to allow data from these two platforms to be analyzed together, 
which is referred to as **product bridging, or Explore 3072 to HT bridging**.

### Considerations for product bridging

Product bridging allows the NPX values of an Olink® Explore 3072 project to be 
normalized and made comparable to the NPX values of an Olink® Explore HT project. This
process is one-directional, and normalizing Explore HT NPX values to Explore 
3072 is not supported. 

The product bridging normalization uses the **~3000** assays that are
overlapping between Explore 3072 and HT. Each overlapping assay undergoes 
a series of checks that evaluate the number of counts, correlation, and 
difference of NPX ranges between the two datasets. If an assay has enough counts
and comparable metrics between the two datasets, it is determined to be suitable
for bridging (referred to as a "bridgeable assay"). The set of "bridgable 
assays" across platforms will vary from dataset to dataset, based on the samples
present within the studies. Depending on the NPX distribution of each bridgeable
assay in the two datasets, the assay is normalized using either median 
normalization or **QQ normalization**.

Product bridging between an Explore 3072 and an Explore HT NPX dataset
requires **40-60 bridging samples**. Bridging samples are shared samples among
datasets - that is that samples that are analyzed in both datasets. Olink® NPX
datasets without shared samples should not be combined using the bridging 
approach described below. Before starting bridging, it is important to check if 
the same sample IDs were assigned to the bridging samples. More information on 
bridge sample selection can be found in the [selecting bridging samples section](https://cran.r-project.org/web/packages/OlinkAnalyze/vignettes/bridging_introduction.html#selecting-bridging-samples)
of the Introduction to Bridging tutorial.

## Bridge Sample Selection

## Import NPX files

The input datasets are standard Olink^®^ NPX^TM^ tables. They can be loaded
using `read_NPX()` function with default Olink Software NPX file as
input.

```{r message=FALSE, eval=FALSE, echo = TRUE}
data_E3072 <- read_NPX("~/NPX_Explore3072_location.parquet") # Could also be a CSV file
data_EHT <- read_NPX("~/NPX_ExploreHT_location.parquet")
```

## Checking input datasets and bridging samples

## Normalization

### Is the Assay Bridgeable

### Normalization using the median of paired differences

If it is expected that both the kind of distribution and the equal variance per test between runs are the same, then the normalization using the median of paired differences will be preferred. The normalization using the median of paired differences based on the bridge samples is performed in the following steps:

  1. For each assay and the Explore 3072 project, calculate the pairwise difference for each of the overlapping samples with the Explore HT project.
  
  2. Estimate the normalization factor of each assay by finding the median of the pairwise differences.
  
  3: Use the assay-specific normalization factor for each assay to normalize each data point from Explore 3072 to Explore HT.

### Quantile-Quantile normalization

Since Explore HT and Explore 3072 are two distinct products and the assays differ considerably between products, some of the assays exist in corresponding but distinct NPX spaces. For those assays, a Quantile-Quantile normalization will be favored. The normalization using the Quantile-Quantile Normalization based on the bridge samples is performed in the following steps:

  1. For each assay of Explore 3072, calculate the empirical distribution function.
  
  2. Map the empirical distribution function from Explore 3072 to the Explore HT space using the quantiles.
  
  3. Construct a spline regression model using the sorted Explore 3072 data and the mapped Explore 3072 data along with the anchor points of the spline function.
  
  4. Use the spline regression model to predict all the data points from Explore 3072 to Explore HT.


### Function Output

## Evaluating the quality of bridging

## Export Normalized Data

## FAQs

### Correlation Assays

Both the Explore 3072 and Explore HT platforms contain correlation assays in 
their biomarker portfolios. In Explore 3072, these present as overlapping assays 
across panels. In Explore HT, these are overlapping assays across blocks. 
The correlation assays are included for QC purposes and allow users to evaluate 
data performance across panels in Explore 3072 and across blocks in Explore HT. 

Within each platform, the correlation assays contain unique OlinkID values for each 
of their corresponding panels and blocks in Explore 3072 and Explore HT, 
respectively. It should be noted that the correlation assays themselves differ
between each platform. For more information on overlapping assays, you can 
access the [Olink FAQ page](https://olink.com/knowledge/faq). 

Explore 3072 to Explore HT bridging generates and returns adjusted values for all 
data points corresponding to each of the Explore 3072 correlation assays. In other
words, each instance of an overlapping assay will contain an adjusted value in its
respective Explore 3072 panel *For consistency in reference values, only the Block 
5 data points from Explore HT's correlation assays are used in the Explore 3072 to
Explore HT bridging process. For downstream analysis, it is recommended to include 
the data from all instances of the correlation assays, barring any clear outliers.* 

### Downstream Analysis


## Contact Us

We are always happy to help. Email us with any questions:

-   biostat\@olink.com for statistical services and general stats
    questions

-   support\@olink.com for Olink lab product and technical support

-   info\@olink.com for more information

## Legal Disclaimer

© 2024 Olink Proteomics AB.

Olink products and services are For Research Use Only and not for Use in
Diagnostic Procedures.

All information in this document is subject to change without notice.
This document is not intended to convey any warranties, representations
and/or recommendations of any kind, unless such warranties,
representations and/or recommendations are explicitly stated.

Olink assumes no liability arising from a prospective reader’s actions
based on this document.

OLINK, NPX, PEA, PROXIMITY EXTENSION, INSIGHT and the Olink logotype are
trademarks registered, or pending registration, by Olink Proteomics AB.
All third-party trademarks are the property of their respective owners.

Olink products and assay methods are covered by several patents and
patent applications <https://olink.com/legal/patents>.

